name: Unit Tests

on:
  push:
    branches:
      - main

jobs:
  go-tests:
    name: Run Go Unit Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - uses: actions/setup-go@v1
        with:
          go-version: 1.14

      - uses: hashicorp/setup-terraform@v1
        with:
          terraform_version: 0.14.7

      - name: Download Go Modules
        working-directory: tests
        run: go mod download

#      - name: Security Scan
#        id: Bridgecrew
#        uses: bridgecrewio/bridgecrew-action@master
#        with:
#          api-key: ${{ secrets.BRIDGECREW_API_KEY }}

      - name: Run Go Tests
        working-directory: tests
        run: |
          go test -v
        env:
          # TF ENVIRONMENT
          TF_AZURE_STORAGE_ACCOUNT: "${{ secrets.NONPROD_AZURE_STORAGE_ACCOUNT }}"
          TF_AZURE_CONTAINER: "${{ secrets.NONPROD_AZURE_STORAGE_CONTAINER  }}"
          ARM_ACCESS_KEY: "${{ secrets.NONPROD_ARM_ACCESS_KEY }}"